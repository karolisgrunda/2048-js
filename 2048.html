<canvas id="gc" width="400" height="400"></canvas>


<script>
    window.onload=function() {
        canv=document.getElementById("gc");
        ctx=canv.getContext("2d");
        document.addEventListener("keydown", keyPush);
    }
    
    var board = [[0, 0, 0 , 0],
                 [0, 0, 0 , 0],
                 [0, 0, 0 , 0],
                 [0, 0, 0 , 0]];
    var gameStart = true;

    function keyPush(evt) {
        switch(evt.keyCode) {
            case 37:
                if (gameStart) {
                    drawPlayground(board);
                    findEmptySpaceAndPlaceNumber(board);
                    addNumbers(board, 'left');
                    gameStart = false;
                }
                drawPlayground(board);
                addNumbers(board, 'left');
                findEmptySpaceAndPlaceNumber(board);
                break;
            case 38:
                case 37:
                console.log('up')
                break;
            case 39:
                console.log('right')
                break;
            case 40:
                console.log('bot')
                break;
        }
    }





    function addNumbers(map, key) {
        if( key == 'left') {
            for (let j = 0; j <= 3; j++){
                for (let i = 0; i <= 2; i++){
                    board[j][i] = board[j][i] + board[j][i + 1]
                    board[j][i + 1] = 0;
                }
            }
        }
    }



    function findEmptySpaceAndPlaceNumber(map) {
        var count = 0;
        var randomPlaceArray = [];

        for (let i = 0; i <= 3 ; i++){
            for (let j = 0; j <= 3 ; j++){
                if (map[i][j] == 0){
                    randomPlaceArray[count] = [i, j];
                    count += 1;
                }
            }
        }

        if (count == 0) {
            board  = [[0, 0, 0 , 0],
                      [0, 0, 0 , 0],
                      [0, 0, 0 , 0],
                      [0, 0, 0 , 0]];
        } else {
            let randomPlace = Math.floor(Math.random() * randomPlaceArray.length);

            let randomX = randomPlaceArray[randomPlace][0];
            let randomY = randomPlaceArray[randomPlace][1];

            board[randomX][randomY] = Math.floor(Math.random() * 2 + 1 );
            console.log(board); 
        }
    }

    function drawPlayground(map) {
        for (let i = 0; i <= 3 ; i++){
            for (let j = 0; j <= 3 ; j++){
                if (map[i][j] == 1) {
                    color = "#FF0000";
                } else if (map[i][j] == 2) {
                    color = "#901919";
                } else {
                    color = "#696969";
                }
                ctx.fillStyle = color;
                ctx.fillRect(j * 100, i * 100, 99, 99);

                ctx.font = "30px Verdana";
                ctx.fillStyle = "#FFFFFF";
                if (map[i][j] != 0) {
                    ctx.fillText(map[i][j], 40 + j * 100, 60 + i * 100);
                }
                    
            }
        }   
    }


</script>
