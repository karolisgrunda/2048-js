<canvas id="gc" width="400" height="400"></canvas>


<script>
    window.onload=function() {
        canv=document.getElementById("gc");
        ctx=canv.getContext("2d");
        document.addEventListener("keydown", keyPush);
    }
    
    var board = [[0, 0, 0 , 0],
                 [0, 0, 0 , 0],
                 [0, 0, 0 , 0],
                 [0, 0, 0 , 0]];
    var gameStart = false;

    function keyPush(evt) {
        switch(evt.keyCode) {
            case 37:
                if (!gameStart) {
                    findEmptySpaceAndPlaceNumber(board);
                    drawPlayground(board);
                    gameStart = true;
                } else {
                    findEmptySpaceAndPlaceNumber(board);
                    drawPlayground(board);
                    addNumbers();
                }
                break;
            case 38:
                case 37:
                console.log('up')
                break;
            case 39:
                console.log('right')
                break;
            case 40:
                console.log('bot')
                break;
        }
    }





    function addNumbers() {
        let swap = false;

            for (let j = 0; j <= 3; j++){      
                if (board[j][3] == board[j][2]) {
                    board[j][2] = board[j][2] * board[j][2];
                    board[j][3] = 0;
                    swap = true;                 
                }        
                if (board[j][1] == board[j][0]) {
                    board[j][0] = board[j][0] * board[j][0];
                    board[j][1] = 0;
                }
                if (board[j][2] == board[j][1] && swap) {
                    board[j][1] = board[j][1] * board[j][1];
                    board[j][2] = 0;
                }
            }
    }



    function findEmptySpaceAndPlaceNumber(map) {
        var count = 0;
        var randomPlaceArray = [];

        for (let i = 0; i <= 3 ; i++){
            for (let j = 0; j <= 3 ; j++){
                if (map[i][j] == 0){
                    randomPlaceArray[count] = [i, j];
                    count += 1;
                }
            }
        }

        if (count == 0) {
            board  = [[0, 0, 0 , 0],
                      [0, 0, 0 , 0],
                      [0, 0, 0 , 0],
                      [0, 0, 0 , 0]];
            console.log('gameover');
        } else {
            let randomPlace = Math.floor(Math.random() * randomPlaceArray.length);

            let randomX = randomPlaceArray[randomPlace][0];
            let randomY = randomPlaceArray[randomPlace][1];
            let randomNumber = Math.floor(Math.random() * 2 + 1 )
            board[randomX][randomY] = randomNumber + randomNumber;
            console.log(board); 
        }
    }

    function drawPlayground(map) {
        for (let i = 0; i <= 3 ; i++){
            for (let j = 0; j <= 3 ; j++){

                ctx.fillStyle = "#696969";
                ctx.fillRect(j * 100, i * 100, 99, 99);

                ctx.font = "30px Verdana";
                ctx.fillStyle = "#FFFFFF";
                if (map[i][j] != 0) {
                    ctx.fillText(map[i][j], 40 + j * 100, 60 + i * 100);
                }
                    
            }
        }   
    }


</script>
